<!DOCTYPE html>
<html>
  <head>
    <title>Euros</title>
    <link rel="stylesheet" type="text/css" href="../coins.css">
    <script src="coins.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.8/handlebars.min.js" type="text/javascript"></script>
    <script id="page-template" type="text/x-handlebars-template">
      <div class="page euros {{country}}">
        <div class="margin">
          {{#each coins}}
            <div class="coin {{type}}">
              <span class="img"><span><img src="{{filename}}" /></span></span>
              <span class="year">{{denomination}}{{spacer}}{{year}}</span>
              <span class="name"><span>{{name}}</span></span>
              <span class="count"></span>
            </div>
          {{/each}}
        </div>
      </div>
    </script>
  </head>
  <body>
    
    <script type="text/javascript">
      var country_coins = [];
      var countries = [];
      
      // Map coins to country lookup
      $.each(raw_coins, function(i) {
          var parts = raw_coins[i].replace('.jpg', '').split('_');
          var coin = {};
          
          // Regular coin
          if (parts.length == 3)
          {
            coin = { 
              filename: raw_coins[i],
              country: parts[0],
              spacer: '',
              year: '',
              type: parts[1],
              name: parts[2],
              denomination: parts[1],
            };
          }
          
          // Commemorative coin
          if (parts.length == 4)
          {
            coin = { 
              filename: raw_coins[i],
              country: parts[0],
              spacer: ' - ',
              type: parts[1],
              year: parts[2],
              name: parts[3],
              denomination: parts[1],
            };
          }
          
          if (coin.type == "1c")  coin.value = 1;
          if (coin.type == "2c")  coin.value = 2;
          if (coin.type == "5c")  coin.value = 5;
          if (coin.type == "10c") coin.value = 10;
          if (coin.type == "20c") coin.value = 20;
          if (coin.type == "50c") coin.value = 50;
          if (coin.type == "€1")  coin.value = 100;
          if (coin.type == "€2")  coin.value = 200;
          
          if (coin.type == "1c") coin.type = "one-cent";
          if (coin.type == "2c") coin.type = "two-cents";
          if (coin.type == "5c") coin.type = "five-cents";
          if (coin.type == "10c") coin.type = "ten-cents";
          if (coin.type == "20c") coin.type = "twenty-cents";
          if (coin.type == "50c") coin.type = "fifty-cents";
          if (coin.type == "€1") coin.type = "one-euro";
          if (coin.type == "€2") coin.type = "two-euros";
          
          // Push coins into collection
          if (country_coins[coin.country] == undefined)
          {
            var flag = {
              filename: "Flag_of_" + coin.country + ".svg.png",
              country: coin.country,
              type: "flag",
              year: coin.country,
              name: '',
            };
            
            countries.push(coin.country);
            country_coins[coin.country] = [];
            country_coins[coin.country].push(flag);
          }
          
          country_coins[coin.country].push(coin);
        });
      
      page_template = Handlebars.compile($("#page-template").html(), { country: "test" });
      
      var coin_sort = function(a, b) {
        if (a.country < b.country) return -1;
        if (a.country > b.country) return -1;
        
        if (a.type == "flag") return -1;
        if (b.type == "flag") return-1;
        
        if (a.year < b.year) return -1;
        if (a.year > b.year) return 1;
        
        if (a.value < b.value) return -1;
        if (a.value > b.value) return 1;
        
        if (a.name < b.name) return -1;
        if (a.name > b.name) return -1;
        
        return 0;
      };
      
      $.each(countries, function(i) {
        var country = countries[i];
        var sorted = country_coins[country].sort(coin_sort);
        
        var batch = sorted.splice(0, 30);
        
        while (batch.length > 0)
        {
          $("body").append(page_template({ country: country, coins: batch }));
          
          var batch = sorted.splice(0, 30);
        }
      });
    </script>
  </body>
</html>